---
layout: post
category : frontend
title: "关于单页应用中各路由页数据依赖研究"
tagline: "不简单的研究"
tags : [frontend]
theme :
  name : twitter
---
{% include JB/setup %}


# 关于单页应用中各路由页数据依赖研究

最近有时间写写最近遇到的问题及其解决方法，是非常好的习惯。React在我们项目中已经用了将近快两个月，遇到自己封装的Router在刷新页面的时候，本身路由变化为`默认设定页`的问题。

分析其原因，页面首次加载（包含F5或者地址栏回车的情况）都会默认跳到`默认设定页`，罪魁祸首是我获取hash值是默认从我的`History`读取的，而且第一次未设置hash值都会是默认值。

要解决页面首次加载，不一定要跳转到`默认设定页`的问题，有两种方式可以解决。

第一种是单个路由页全部加载自己页面依赖的所有数据。

第二种是加载依赖页面的数据和自己页面所需的数据。

接下来，我们就来讨论两种方案的可行性。

## 单个路由页全部加载自己页面依赖的所有数据

这种方案的好处，在于我不用知道所有的数据依赖关系，只需要知道当前页面所依赖的所有数据。

我们当然希望，所有的页面能在首次访问都能加载所有的数据，但是我们实际开发项目中，有些数据是需要从上一个页面继承的[ 也就是我们所说的`页面依赖数据` ]。

![页面依赖数据](/assets/images/frontend/页面依赖数据.svg)

## 加载依赖页面的数据和自己页面所需的数据

上一种解决方案，不能解决页面间数据依赖的问题，所以这里需要有一种依赖数据检测机制，去检测当前页面所需要的全部依赖数据，并一起加载。

当页面依赖数据加载完成，再重新刷新页面，让页面重新从Store中拿取数据。

![页面初始化数据分类](/assets/images/frontend/页面初始化数据分类.svg)
